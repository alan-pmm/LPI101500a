#-- 101.1 Determine and configure hardware settings
#-- Shows all devices currently connected to the PCI (Peripheral Component Interconnect) bus.
#--command 'lspci' (Peripheral Component Interconnect) bus


alain@ubuntuserver22:~$ lspci
00:00.0 Host bridge: Intel Corporation 440FX - 82441FX PMC [Natoma] (rev 02)
00:01.0 ISA bridge: Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]
00:01.1 IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)
00:02.0 VGA compatible controller: VMware SVGA II Adapter
00:03.0 Ethernet controller: Intel Corporation 82540EM Gigabit Ethernet Controll                                     er (rev 02)
00:04.0 System peripheral: InnoTek Systemberatung GmbH VirtualBox Guest Service
00:05.0 Multimedia audio controller: Intel Corporation 82801AA AC'97 Audio Contr                                     oller (rev 01)
00:06.0 USB controller: Apple Inc. KeyLargo/Intrepid USB
00:07.0 Bridge: Intel Corporation 82371AB/EB/MB PIIX4 ACPI (rev 08)
00:0b.0 USB controller: Intel Corporation 82801FB/FBM/FR/FW/FRW (ICH6 Family) US                                     B2 EHCI Controller
00:0d.0 SATA controller: Intel Corporation 82801HM/HEM (ICH8M/ICH8M-E) SATA Cont                                     roller [AHCI mode] (rev 02)

#--command 'lsusb' (Universal Serial Bus)

#--Lists USB (Universal Serial Bus) devices currently connected to the machine
alain@ubuntuserver22:~$ lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 002: ID 80ee:0021 VirtualBox USB Tablet
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub


#--The command lspci shows more details about a specific device if its address is given with option -s
alain@ubuntuserver22:~$ lspci -s 00:01.0
00:01.0 ISA bridge: Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]

#--more with, accompanied by the option combined -s -v
alain@ubuntuserver22:~$ lspci -s 00:01.0 -v
00:01.0 ISA bridge: Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]
        Flags: bus master, medium devsel, latency 0

#--more again with, accompanied by the option combined -s -v
alain@ubuntuserver22:~$ lspci -s 00:01.0 -vv
00:01.0 ISA bridge: Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]
        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-
        Status: Cap- 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR- INTx-
        Latency: 0
		
#-- verify which kernel module is in use for the specified device is provided by the option -k,
alain@ubuntuserver22:~$ lspci -s 00:01.0 -k
00:01.0 ISA bridge: Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]

#--Command lsusb shows the available USB channels and the devices connected to them. like lspci option 
#  -v displays more detailed output. 
#  -d specific device can be selected for inspection by providing its ID

alain@ubuntuserver22:~$ lsusb -v -d 1d6b:0002
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Couldn't open device, some information will be missing
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            9 Hub
  bDeviceSubClass         0
  bDeviceProtocol         0 Full speed (or root) hub
  bMaxPacketSize0        64
  idVendor           0x1d6b Linux Foundation
  idProduct          0x0002 2.0 root hub
  bcdDevice            5.15
  iManufacturer           3 Linux 5.15.0-88-generic ehci_hcd
  iProduct                2 EHCI Host Controller
  iSerial                 1 0000:00:0b.0
  bNumConfigurations      1
  Configuration Descriptor:
    bLength                 9
    bDescriptorType         2
    wTotalLength       0x0019
    bNumInterfaces          1
    bConfigurationValue     1
    iConfiguration          0
    bmAttributes         0xe0
      Self Powered
      Remote Wakeup
    MaxPower                0mA
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        0
      bAlternateSetting       0
      bNumEndpoints           1
      bInterfaceClass         9 Hub
      bInterfaceSubClass      0
      bInterfaceProtocol      0 Full speed (or root) hub
      iInterface              0
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x81  EP 1 IN
        bmAttributes            3
          Transfer Type            Interrupt
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0004  1x 4 bytes
        bInterval              12

#--With option -t, command lsusb shows the current USB device mappings as a hierarchical tree -- page 7
alain@ubuntuserver22:~$ lsusb -t
/:  Bus 02.Port 1: Dev 1, Class=root_hub, Driver=ohci-pci/12p, 12M
    |__ Port 1: Dev 2, If 0, Class=Human Interface Device, Driver=usbhid, 12M
/:  Bus 01.Port 1: Dev 1, Class=root_hub, Driver=ehci-pci/12p, 480M

#--works also with lspci and -t option and -v option (optionally)

alain@ubuntuserver22:~$ lspci -vt
-[0000:00]-+-00.0  Intel Corporation 440FX - 82441FX PMC [Natoma]
           +-01.0  Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]
           +-01.1  Intel Corporation 82371AB/EB/MB PIIX4 IDE
           +-02.0  VMware SVGA II Adapter
           +-03.0  Intel Corporation 82540EM Gigabit Ethernet Controller
           +-04.0  InnoTek Systemberatung GmbH VirtualBox Guest Service
           +-05.0  Intel Corporation 82801AA AC'97 Audio Controller
           +-06.0  Apple Inc. KeyLargo/Intrepid USB
           +-07.0  Intel Corporation 82371AB/EB/MB PIIX4 ACPI
           +-0b.0  Intel Corporation 82801FB/FBM/FR/FW/FRW (ICH6 Family) USB2 EHCI Controller
           \-0d.0  Intel Corporation 82801HM/HEM (ICH8M/ICH8M-E) SATA Controller [AHCI mode]


#-- Not all devices have corresponding modules. 

alain@ubuntuserver22:~$ lsusb -s 1
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub

alain@ubuntuserver22:~$ lsusb -s 2
Bus 002 Device 002: ID 80ee:0021 VirtualBox USB Tablet

#-- Both Bus and Dev numbers should be given to the -s option of the lsusb command
alain@ubuntuserver22:~$ lsusb -s 2:2
Bus 002 Device 002: ID 80ee:0021 VirtualBox USB Tablet

#--We can find a lot of loaded kernel modules in a standard Linux, viewable using 'kmod' package

#  Linux kernel modules related to hardware devices are also called drivers

#--command 'lsmod' shows all currently loaded modules:
#  3 COLUMNS :
#  Module : Module name.
#  Size : Amount of RAM occupied by the module, in bytes.
#  Used by : Depending modules.

alain@ubuntuserver22:~$ lsmod | head -n 7
Module                  Size  Used by
vboxsf                 36864  0
vboxguest              45056  3 vboxsf
vboxvideo              28672  0
drm_vram_helper        24576  1 vboxvideo
drm_ttm_helper         16384  2 drm_vram_helper,vboxvideo
binfmt_misc            24576  1


# -- command 'modprobe':
# as long as they are not being used by a running process, command modprobe -r should be used.
alain@ubuntuserver22:~$ modprobe -r vboxguest
modprobe: FATAL: Module vboxguest is in use.

alain@ubuntuserver22:~$ modprobe -r drm_vram_helper
modprobe: FATAL: Module drm_vram_helper is in use.

alain@ubuntuserver22:~$ modprobe -r snd_ac97_codec
modprobe: FATAL: Module snd_ac97_codec is in use.

# command 'modinfo' shows a description, the file,the author, the license, the identification, the dependencies and the available parameters for the given module. Option -p will make command modinfo display all available parameters and ignore the other information.

alain@ubuntuserver22:~$ modinfo -p snd_ac97_codec
enable_loopback:Enable AC97 ADC/DAC Loopback Control (bool)
power_save:Automatic power-saving timeout (in second, 0 = disable). (int)

# command 'modinfo' without option

alain@ubuntuserver22:~$ modinfo snd_ac97_codec
filename:       /lib/modules/5.15.0-88-generic/kernel/sound/pci/ac97/snd-ac97-codec.ko
license:        GPL
description:    Universal interface for Audio Codec '97
author:         Jaroslav Kysela <perex@perex.cz>
srcversion:     1FD0F36AF953EF83BBC58CD
depends:        snd,snd-pcm,ac97_bus
retpoline:      Y
intree:         Y
name:           snd_ac97_codec
vermagic:       5.15.0-88-generic SMP mod_unload modversions
sig_id:         PKCS#7
signer:         Build time autogenerated kernel key
sig_key:        1E:90:54:F5:F2:F5:58:6D:E9:90:EB:09:88:88:6A:2E:8D:1A:E8:0B
sig_hashalgo:   sha512
signature:      59:7E:4C:9A:3E:B7:28:93:80:B0:CE:2A:63:68:02:B1:07:DD:CC:A4:
                2C:DB:3D:56:75:6E:03:25:B5:94:32:3D:D6:93:58:2D:F6:3F:15:C7:
  .....
parm:           enable_loopback:Enable AC97 ADC/DAC Loopback Control (bool)
parm:           power_save:Automatic power-saving timeout (in second, 0 = disable). (int)


# If a module is causing problems, the file /etc/modprobe.d/blacklist.conf can be used to block the loading of the module. 
alain@ubuntuserver22:~$ ls /etc/modprobe.d/
amd64-microcode-blacklist.conf  blacklist-firewire.conf      intel-microcode-blacklist.conf
blacklist-ath_pci.conf          blacklist-framebuffer.conf   iwlwifi.conf
blacklist.conf                  blacklist-rare-network.conf  mdadm.conf


# 'modinfo' option -a shows the author of the module 
alain@ubuntuserver22:~$ modinfo -a snd_ac97_codec
Jaroslav Kysela <perex@perex.cz>

alain@ubuntuserver22:~$ modinfo -k snd_ac97_codec
modinfo: ERROR: missing module or filename.


# modinfo ... -h option to show help! :-)
alain@ubuntuserver22:~$ modinfo -h snd_ac97_codec
Usage:
        modinfo [options] filename [args]
Options:
        -a, --author                Print only 'author'
        -d, --description           Print only 'description'
        -l, --license               Print only 'license'
        -p, --parameters            Print only 'parm'
        -n, --filename              Print only 'filename'
        -0, --null                  Use \0 instead of \n
        -F, --field=FIELD           Print only provided FIELD
        -k, --set-version=VERSION   Use VERSION instead of `uname -r`
        -b, --basedir=DIR           Use DIR as filesystem root for /lib/modules
        -V, --version               Show version
        -h, --help                  Show this help

# modinfo -n option to show library location 
alain@ubuntuserver22:~$ modinfo -n snd_ac97_codec
/lib/modules/5.15.0-88-generic/kernel/sound/pci/ac97/snd-ac97-codec.ko


# modinfo -l option to show licence. it is a GPL of course :-)
alain@ubuntuserver22:~$ modinfo -l snd_ac97_codec
GPL

# modinfo -F option to show field.. NOK
alain@ubuntuserver22:~$ modinfo -F snd_ac97_codec
modinfo: ERROR: missing module or filename.

# modinfo with -V to show the 'kmod' version
alain@ubuntuserver22:~$ modinfo -V snd_ac97_codec
kmod version 29
+ZSTD +XZ -ZLIB +LIBCRYPTO -EXPERIMENTAL

# /proc and /sys are called pseudo filesystem. They are mount points to filesystems not present in a device partition, but only in RAM space used by the kernel to store runtime configuration and information on running processes. 

# '/proc/cpuinfo' lists detailed information about the CPU(s) found by the operating system.
alain@ubuntuserver22:~$ cat ll /proc/cpuinfo
cat: ll: No such file or directory
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 6
model           : 140
model name      : 11th Gen Intel(R) Core(TM) i5-1145G7 @ 2.60GHz
stepping        : 1
microcode       : 0xffffffff
cpu MHz         : 2611.368
cache size      : 8192 KB
physical id     : 0
siblings        : 1
core id         : 0
cpu cores       : 1
apicid          : 0
initial apicid  : 0
fpu             : yes
fpu_exception   : yes
cpuid level     : 22
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 movbe popcnt aes rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ibrs_enhanced fsgsbase bmi1 bmi2 invpcid rdseed clflushopt md_clear flush_l1d arch_capabilities
bugs            : spectre_v1 spectre_v2 spec_store_bypass swapgs retbleed eibrs_pbrsb
bogomips        : 5222.73
clflush size    : 64
cache_alignment : 64
address sizes   : 39 bits physical, 48 bits virtual
power management:


# '/proc/interrupts' :A list of numbers of the interrupts per IO device for each CPU.

alain@ubuntuserver22:~$ cat /proc/interrupts
           CPU0
  0:         44   IO-APIC   2-edge      timer
  1:          9   IO-APIC   1-edge      i8042
  8:          0   IO-APIC   8-edge      rtc0
  9:          0   IO-APIC   9-fasteoi   acpi
 12:        158   IO-APIC  12-edge      i8042
 14:          0   IO-APIC  14-edge      ata_piix
 15:        880   IO-APIC  15-edge      ata_piix
 18:       3113   IO-APIC  18-fasteoi   vmwgfx
 19:       2732   IO-APIC  19-fasteoi   ehci_hcd:usb1, enp0s3
 20:        300   IO-APIC  20-fasteoi   vboxguest
 21:      21389   IO-APIC  21-fasteoi   ahci[0000:00:0d.0], snd_intel8x0
 22:         25   IO-APIC  22-fasteoi   ohci_hcd:usb2
NMI:          0   Non-maskable interrupts
LOC:     187994   Local timer interrupts
SPU:          0   Spurious interrupts
PMI:          0   Performance monitoring interrupts
IWI:          0   IRQ work interrupts
RTR:          0   APIC ICR read retries
RES:          0   Rescheduling interrupts
CAL:          0   Function call interrupts
TLB:          0   TLB shootdowns
TRM:          0   Thermal event interrupts
THR:          0   Threshold APIC interrupts
DFR:          0   Deferred Error APIC interrupts
MCE:          0   Machine check exceptions
MCP:          3   Machine check polls
ERR:          0
MIS:          0
PIN:          0   Posted-interrupt notification event
NPI:          0   Nested posted-interrupt event
PIW:          0   Posted-interrupt wakeup event



#-- /proc/ioports : Lists currently registered Input/Output port regions in use. (page 11) 
alain@ubuntuserver22:~$ cat /proc/ioports
0000-0000 : PCI Bus 0000:00
  0000-0000 : dma1
  0000-0000 : pic1
  0000-0000 : timer0
  0000-0000 : timer1
  0000-0000 : keyboard
  0000-0000 : keyboard
  0000-0000 : rtc_cmos
    0000-0000 : rtc0
  0000-0000 : dma page reg
  0000-0000 : pic2
  0000-0000 : dma2
  0000-0000 : fpu
  0000-0000 : 0000:00:01.1
    0000-0000 : ata_piix
  0000-0000 : 0000:00:01.1
    0000-0000 : ata_piix
  0000-0000 : 0000:00:01.1
    0000-0000 : ata_piix
  0000-0000 : vga+
  0000-0000 : 0000:00:01.1
    0000-0000 : ata_piix
0000-0000 : PCI conf1
0000-0000 : PCI Bus 0000:00
  0000-0000 : 0000:00:07.0
    0000-0000 : ACPI PM1a_EVT_BLK
    0000-0000 : ACPI PM1a_CNT_BLK
    0000-0000 : ACPI PM_TMR
    0000-0000 : ACPI GPE0_BLK
  0000-0000 : 0000:00:07.0
    0000-0000 : piix4_smbus
  0000-0000 : 0000:00:01.1
    0000-0000 : ata_piix
  0000-0000 : 0000:00:02.0
    0000-0000 : vmwgfx probe
  0000-0000 : 0000:00:03.0
    0000-0000 : e1000
  0000-0000 : 0000:00:04.0
    0000-0000 : vboxguest
  0000-0000 : 0000:00:05.0
    0000-0000 : Intel 82801AA-ICH
  0000-0000 : 0000:00:05.0
    0000-0000 : Intel 82801AA-ICH
  0000-0000 : 0000:00:0d.0
    0000-0000 : ahci
  0000-0000 : 0000:00:0d.0
    0000-0000 : ahci
  0000-0000 : 0000:00:0d.0
    0000-0000 : ahci
  0000-0000 : 0000:00:0d.0
    0000-0000 : ahci
  0000-0000 : 0000:00:0d.0
    0000-0000 : ahci
# /proc and /sys directory have similar roles, see note 'page 11'
#--'/proc' contains kernel data structures, including running processes
#--'/sys' store device information and kernel data related to hardware

#--'/dev' this repo is the storage device
# for IDE (legacy HDD) partition are /dev/hda1, /dev/hda2
# for floppy disk /dev/fdO,/dev/fd1, etc

# From Linux kernel version 2.4 onwards, most storage devices are now identified as if they were SCSI devices, regardless of their hardware type. IDE, SSD and USB block devices will be prefixed by sd.

alain@ubuntuserver22:~$ df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           197M  1.3M  196M   1% /run
/dev/sda2       232G  7.9G  212G   4% /
tmpfs           983M     0  983M   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
/dev/sda5       250G   24M  237G   1% /home
/dev/sda3       265M  245M     0 100% /boot
tmpfs           197M  4.0K  197M   1% /run/user/1001

#--! Exeptions ! '/dev/mmcblk0p' and '/dev/nvme0n'
# For SD cards, the paths is /dev/mmcblk0p1, /dev/mmcblk0p2
# For NVMe devices, the paths is /dev/nvme0n1p1 and /dev/nvme0n1p2


#--'udev' Removable devices are handled by the udev subsystem, dinamically created in /dev.
#   Udev relies on SysFS, the pseudo filesystem for hardware related information mounted in /sys.
# 	Udev identificate devices present during machine power-up = "coldplug detection"
# 	Udev identificate devices while the system is running (hotplug detection)

#--'Hotplug' = detection while system running, system buses (PCI, USB, etc.)

#--'udev' has its rules stored in the directory /etc/udev/rules.d/.
alain@ubuntuserver22:~$ ls /etc/udev/rules.d/
60-vboxadd.rules  70-snap.snapd.rules

#--'/etc/udev'
alain@ubuntuserver22:~$ cat /etc/udev/rules.d/60-vboxadd.rules
KERNEL=="vboxguest", NAME="vboxguest", OWNER="vboxadd", MODE="0660"
KERNEL=="vboxuser", NAME="vboxuser", OWNER="vboxadd", MODE="0666"

#--'/sys' content first depth
alain@ubuntuserver22:~$ tree -L 1 /sys/
/sys/
├── block
├── bus
├── class
├── dev
├── devices
├── firmware
├── fs
├── hypervisor
├── kernel
├── module
└── power
